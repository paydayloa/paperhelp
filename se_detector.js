var SE_DETECTOR = { _seTemplates : [ // WorldWide ["www.google.", "q"], ["search.yahoo.", "p"], ["www.bing.com", "q"], ["search.aol.com", "q"], ["nova.rambler.ru", "query"], ["yandex.com", "text"], ["www.ask.com", "q"], ["search.lycos.com", "q"], ["search.about.com", "q"], ["www.mamma.com", "q"], [".voila.fr", "q"], ["www.baidu.com", "wd"], ["www.search.com", "q"], ["search.yam.com", "k"], ["edition.cnn.com", "query"], ["search.naver.com", "query"], ["ricerca.virgilio.it", "qs"], ["szukaj.wp.pl", "szukaj"], ["www.kvasir.no", "q"], ["arama.mynet.com", "q"], // POST USSR ["go.mail.ru", "q"], ["nigma.ru", "s"], ["yandex.", "text"], ["webalta.ru", "q"], ["aport.ru", "r"], ["meta.ua", "q"], ["search.bigmir.net", "z"], ["search.tut.by", "query"], ["search.ukr.net", "q"], ["search.qip.ru", "query"], ["results.metabot.ru", "st"], ], // Hostname parser: _getHostname : function (url) { var hostname, rx, parts; var referrer = url || ""; // If user agent specified if (referrer !== "") { // Universal URL parsing RegExp [ from http://habrahabr.ru/post/65407/ ] rx = new RegExp("^(([^:/\\?#]+):)?(//(([^:/\\?#]*)(?::([^/\\?#]*))?))?([^\\?#]*)(\\?([^#]*))?(#(.*))?$"); parts = rx.exec(referrer); // getting hostname url part or nothing hostname = parts[5] || ""; } else { // We have no user agent specified hostname = ""; } return hostname; }, // Search engine detection getSearchEngine : function (url) { // Get hostname of referrer var hostname = this._getHostname(url); var tplcount = this._seTemplates.length; for (var i = 0; i < tplcount; i++) { if (hostname.indexOf(this._seTemplates[i][0]) !== -1) { return ['_addOrganic', hostname, this._seTemplates[i][1]]; } } return ""; }, };